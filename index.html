<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Magic Garden Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root{--bg:#121212;--card:#1e1e1e;--text:#e0e0e0;--accent:#4caf50;--line:#333}
    body{background:var(--bg);color:var(--text);font-family:system-ui,sans-serif;margin:1rem}
    .card{background:var(--card);border:1px solid var(--line);padding:1.2rem;margin-bottom:1.2rem;border-radius:8px}
    h2{margin-top:0;color:var(--accent)}
    label{display:block;margin:.6rem 0 .2rem}
    input[type=number],select{width:6rem;padding:.4rem;background:#2a2a2a;color:var(--text);border:1px solid var(--line);border-radius:4px}
    button{margin-top:1rem;padding:.5rem 1.3rem;background:var(--accent);color:#000;border:none;border-radius:4px;font-weight:bold}
    b{color:#fff}
  </style>
</head>
<body>
  <h1>Magic Garden Calculator</h1>

  <!-- ‚ûä XP-Level-Time -->
  <div class="card">
    <h2>‚è±Ô∏è XP-Level-Time</h2>
    <label>Current XP <input id="curXp" type="number" min="0" value="0"></label>
    <label>Target XP <input id="tarXp" type="number" min="1" value="12000"></label>
    <label>Bonus XP per trigger <input id="bonusAmt" type="number" min="0" value="86"></label>
    <label>Custom chance / min (%) <input id="chanceMin" type="number" min="0" max="100" step="0.1" value="15"></label>
    <label><input id="hasXpBoost" type="checkbox" checked> Has XP Boost I?</label>
    <button onclick="calcXp()">Calc</button>
    <p id="xpOut"></p>
  </div>

  <!-- ‚ûã Rainbow / Gold Granter -->
  <div class="card">
    <h2>üåà Rainbow / Gold Granter</h2>
    <label>STR <input id="granterStr" type="number" min="50" max="300" value="100"></label>
    <button onclick="calcGranter()">Calc</button>
    <p id="granterOut"></p>
  </div>

  <!-- ‚ûå Crop Scale-Boost Timer -->
  <div class="card">
    <h2>üå± Crop Scale-Boost Timer</h2>
    <label>Pet
      <select id="petSelect">
        <option value="butterfly">Butterfly</option>
        <option value="bee">Bee</option>
      </select>
    </label>
    <label>STR <input id="scaleStr" type="number" min="50" max="300" value="100"></label>
    <button onclick="calcScale()">Calc</button>
    <p id="scaleOut"></p>
  </div>

<script>
const GRANTER = 0.0072; // wiki granter

/* ---------- XP-Level-Time ---------- */
function calcXp(){
  const cur   = +document.getElementById('curXp').value || 0;
  const tar   = +document.getElementById('tarXp').value || 12000;
  const bonus = +document.getElementById('bonusAmt').value || 86;
  const chancePerMin = +document.getElementById('chanceMin').value || 15;
  const has   = document.getElementById('hasXpBoost').checked;
  if(cur >= tar){ alert('Target XP must be > Current XP'); return; }

  const triggerChance = has ? chancePerMin / 60 / 100 : 0;
  const bonusPerSec   = triggerChance * bonus;
  const avgXPperSec   = 1 + bonusPerSec;
  const secondsNeeded = (tar - cur) / avgXPperSec;

  const totalMin = secondsNeeded / 60;
  const h = Math.floor(totalMin / 60);
  const m = Math.ceil(totalMin % 60 || 1);

  document.getElementById('xpOut').innerHTML =
    `Average XP/s: <b>${avgXPperSec.toFixed(2)}</b><br>` +
    `Est. time to target: <b>${h}h ${m}m</b>`;
}

/* ---------- Rainbow / Gold Granter ---------- */
function calcGranter(){
  const str = Math.max(50, Math.min(300, +document.getElementById('granterStr').value));
  const perSec = GRANTER * str / 60 / 100;
  const avg    = 1 / perSec;
  const wait95 = -Math.log(1-0.95) / perSec;

  const totalMin = avg / 60;
  const h1 = Math.floor(totalMin / 60);
  const m1 = Math.ceil(totalMin % 60 || 1);
  const totalMin95 = wait95 / 60;
  const h95 = Math.floor(totalMin95 / 60);
  const m95 = Math.ceil(totalMin95 % 60 || 1);

  document.getElementById('granterOut').innerHTML =
    `Average: <b>${h1 ? h1+'h '+m1+'m' : m1+'m'}</b><br>` +
    `95 % within: <b>${h95 ? h95+'h '+m95+'m' : m95+'m'}</b>`;
}

/* ---------- Crop Scale-Boost Timer (corrected using wiki values) ---------- */
function calcScale(){
  // clamp user STR input (50 - 300)
  const str   = Math.max(50, Math.min(300, +document.getElementById('scaleStr').value));
  const pet   = document.getElementById('petSelect').value;

  // Using the wiki ability values (percent numbers):
  // Bee:       Probability = 0.30% √ó STR#    Scale = 6.0% √ó STR#
  // Butterfly: Probability = 0.40% √ó STR#    Scale = 10%  √ó STR#
  // (STR# is interpreted as STR / 100)
  let probPct, scalePct;
  if(pet === 'butterfly'){
    probPct  = 0.40; // 0.40 %
    scalePct = 10.0; // 10 %
  } else {
    probPct  = 0.30; // 0.30 %
    scalePct = 6.0;  // 6.0 %
  }

  const strFactor = str / 100;                // STR# (so input 100 -> 1.0)
  const probPercentPerMinute = probPct * strFactor; // e.g. 0.30% * 1 => 0.30% per minute
  const perMinuteDecimal = probPercentPerMinute / 100; // convert % -> decimal per minute
  const perSec = perMinuteDecimal / 60;               // convert to per-second rate (Œª)

  const avgSec    = 1 / perSec;                       // mean wait in seconds
  const wait95Sec = -Math.log(1 - 0.95) / perSec;     // 95% wait in seconds

  function fmtSecondsAsHMS(seconds){
    const totalMin = seconds / 60;
    const h = Math.floor(totalMin / 60);
    const m = Math.ceil(totalMin % 60);
    return h ? `${h}h ${m}m` : `${m}m`;
  }

  const boostPctDisplayed = (scalePct * strFactor); // e.g. 6% * 1.0 => 6%

  document.getElementById('scaleOut').innerHTML =
    `Average: <b>${fmtSecondsAsHMS(avgSec)}</b><br>` +
    `95 % within: <b>${fmtSecondsAsHMS(wait95Sec)}</b><br>` +
    `Boost Size: <b>${boostPctDisplayed.toFixed(1)}%</b>`;
}
</script>
</body>
</html>